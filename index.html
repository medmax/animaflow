<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anima Flow — Cours de yoga & pilates en ligne avec Amina</title>
    <meta name="description" content="Cours de yoga-pilates fusion en visioconference avec Amina. Des 10€ la seance, 10 places max, sans abonnement. Reservez en ligne.">
    <meta name="theme-color" content="#5c6b4f">
    <link rel="canonical" href="https://animaflow.fr/">

    <!-- Open Graph -->
    <meta property="og:title" content="Anima Flow — Yoga & Pilates en ligne avec Amina">
    <meta property="og:description" content="Cours de yoga-pilates fusion en visio avec Amina. Des 10€ la seance, 10 places max, sans abonnement.">
    <meta property="og:image" content="https://animaflow.fr/images/Background-Hero.jpg">
    <meta property="og:url" content="https://animaflow.fr/">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="fr_FR">
    <meta property="og:site_name" content="Anima Flow">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Anima Flow — Yoga & Pilates en ligne avec Amina">
    <meta name="twitter:description" content="Cours de yoga, pilates et renforcement doux en visio. 15€ la seance, 10 places max.">
    <meta name="twitter:image" content="https://animaflow.fr/images/Background-Hero.jpg">

    <!-- Schema.org JSON-LD -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SportsActivityLocation",
        "name": "Anima Flow",
        "description": "Cours de yoga, pilates et renforcement doux en visioconference avec Amina Yakoubi, instructrice certifiee.",
        "url": "https://animaflow.fr",
        "telephone": "+33777322761",
        "email": "animaflow92@gmail.com",
        "priceRange": "10€-20€",
        "address": {
            "@type": "PostalAddress",
            "addressCountry": "FR"
        },
        "founder": {
            "@type": "Person",
            "name": "Amina Yakoubi",
            "jobTitle": "Instructrice de Yoga & Pilates"
        },
        "offers": {
            "@type": "Offer",
            "price": "10",
            "priceCurrency": "EUR",
            "description": "Cours collectif en visioconference — 60 min, 10 places max"
        }
    }
    </script>

    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>

<div id="mon-app" v-cloak>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="logo">Anima Flow</div>
        <button class="burger" @click="menuOuvert = !menuOuvert" :class="{ active: menuOuvert }">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <ul class="nav-links" :class="{ open: menuOuvert }">
            <li><a href="#accueil" @click="menuOuvert = false">Accueil</a></li>
            <li><a href="#apropos" @click="menuOuvert = false">Amina</a></li>
            <li><a href="#cours" @click="menuOuvert = false">Les cours</a></li>
            <li><a href="#bienfaits" @click="menuOuvert = false">Tes avantages</a></li>
            <li><a href="#contact" @click="menuOuvert = false">Reserver</a></li>
        </ul>
    </nav>

    <!-- Hero -->
    <section id="accueil" class="hero">
        <div class="hero-content">
            <h1>Un seul cours par semaine. Enfin du temps pour toi.</h1>
            <p class="hero-subtitle">Yoga, Pilates & renforcement doux en visioconference — 60 min chrono, depuis chez toi, avec Amina.</p>
            <a href="#contact" class="btn">Reserver</a>
        </div>
    </section>

    <!-- A propos -->
    <section id="apropos" class="apropos">
        <div class="container">
            <h2>Amina, ton accompagnatrice</h2>
            <div class="apropos-content">
                <div class="apropos-img">
                    <img src="images/amina-portrait.jpg" alt="Amina Yakoubi, instructrice de yoga et pilates — Anima Flow" class="img-portrait">
                    <div class="apropos-badges">
                        <span class="badge-certif">Educatrice sportive diplomee d'Etat</span>
                        <span class="badge-certif">Professeure certifiee Yoga traditionnel</span>
                        <span class="badge-certif">Formee Sport-Sante</span>
                        <span class="badge-certif">Pilates · BodyPump Les Mills</span>
                    </div>
                </div>
                <div class="apropos-text">
                    <p>Ancienne cadre dans le consulting et la banque, j'ai decouvert le yoga et le mouvement qui m'ont guidee tout au long de ma carriere. Passionnee par cette pratique, j'ai entrepris une reconversion douce en me formant petit a petit.</p>
                    <p>Aujourd'hui, depuis une dizaine d'annees, j'accompagne des personnes comme toi vers plus de vitalite et d'equilibre. Educatrice sportive diplomee d'Etat et professeure certifiee de yoga traditionnel, je suis aussi formee en sport-sante.</p>
                    <p>J'ai fonde Anima Flow pour proposer des pratiques douces et dynamiques, bienveillantes et respectueuses du corps. Mon approche allie rigueur et ecoute, avec pour objectif d'accompagner chacun·e vers plus de serenite et de confiance.</p>

                    <div class="apropos-parcours">
                        <h3>Mon parcours</h3>
                        <ul>
                            <li>Une dizaine d'annees d'enseignement (salles de sport, studios de yoga, cours prives, entreprises, en ligne)</li>
                            <li>Formee aux methodes internationales : Yoga (Kaivalyadham), Pilates Matwork (1, 2, 3), BodyPump Les Mills</li>
                            <li>Specialisations : Post-partum, femmes enceintes, seniors, adaptations posturales</li>
                            <li>Certifications : CQP ALS AGEE, Educateur 3S Sport-Sante</li>
                        </ul>
                    </div>

                    <p class="citation">"Mon but ? Que tu quittes le cours en te disant : 'J'ai pris soin de moi, je suis fiere de moi.' Pas de performance, pas de competition. Juste toi, ton tapis, et un moment de reconnexion."</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Cours -->
    <section id="cours" class="cours">
        <div class="container">
            <h2>Un cours. Trois disciplines.</h2>
            <p class="cours-intro">60 minutes qui fusionnent yoga, pilates et meditation guidee — pour un corps qui te porte et un esprit qui te soutient.</p>
            <div class="cours-grid">
                <div class="cours-card cours-card-yoga">
                    <h3>Yoga Flow</h3>
                    <p>Mobilite & fluidite</p>
                </div>
                <div class="cours-card cours-card-pilates">
                    <h3>Pilates Core</h3>
                    <p>Force & posture</p>
                </div>
                <div class="cours-card cours-card-meditation">
                    <h3>Meditation</h3>
                    <p>Calme & reconnexion</p>
                </div>
            </div>

            <div class="cours-details">
                <div class="cours-detail-card">
                    <h3>Comment je guide le cours</h3>
                    <p>Chaque lundi, je m'adapte a l'energie du groupe et au rythme de chacun·e. Je prends en compte tes besoins, tes eventuelles douleurs ou fatigue du jour, tout en te poussant juste ce qu'il faut pour progresser sans forcer.</p>
                    <p>Tous niveaux bienvenus — je propose des variantes pour que chacun·e trouve sa place, que tu debutes ou que tu pratiques depuis des annees.</p>
                </div>
                <div class="cours-detail-card">
                    <h3>Materiel necessaire</h3>
                    <p>Un tapis de yoga (ou une serviette epaisse) et une webcam pour que je puisse te voir et t'accompagner au mieux.</p>
                </div>
            </div>

        </div>
    </section>

    <!-- Bienfaits -->
    <section id="bienfaits" class="bienfaits">
        <div class="container">
            <h2>Ce qui t'attend avec nous</h2>
            <div class="bienfaits-grid">
                <div class="bienfait-item">
                    <div class="bienfait-icone">&#x1F3E0;</div>
                    <h3>Depuis chez toi</h3>
                    <p>Zero deplacement, zero contrainte. Tu te connectes depuis ton salon.</p>
                </div>
                <div class="bienfait-item">
                    <div class="bienfait-icone">&#x1F465;</div>
                    <h3>Petit groupe (10 max)</h3>
                    <p>Je te vois, je te connais, je corrige ta posture en direct.</p>
                </div>
                <div class="bienfait-item">
                    <div class="bienfait-icone">&#x1F3AF;</div>
                    <h3>Tous niveaux</h3>
                    <p>Debutant ou confirme, je propose des variantes pour que chacun·e trouve sa place.</p>
                </div>
                <div class="bienfait-item">
                    <div class="bienfait-icone">&#x2713;</div>
                    <h3>Prof certifiee</h3>
                    <p>Educatrice sportive diplomee d'Etat et professeure de yoga traditionnel.</p>
                </div>
            </div>
            <div class="bienfaits-cta">
                <button class="btn" @click="ouvrirModal()">Je reserve ma place</button>
            </div>
        </div>
    </section>

    <!-- Contact -->
    <section id="contact" class="contact">
        <div class="container">
            <h2>Commence cette semaine</h2>
            <p class="contact-intro">Une heure. Un tapis. Et Amina qui t'accompagne. Sans abonnement, annulation libre jusqu'a 24h avant.</p>
            <div class="contact-info">
                <div class="info-item">
                    <strong>Email</strong>
                    <span><a href="mailto:animaflow92@gmail.com">animaflow92@gmail.com</a></span>
                </div>
                <div class="info-item">
                    <strong>Telephone</strong>
                    <span>+33 (0)7 77 32 27 61</span>
                </div>
                <div class="info-item">
                    <strong>Prix</strong>
                    <span>15&euro; par seance</span>
                </div>
                <div class="info-item">
                    <strong>Format</strong>
                    <span>Visioconference · 60 min</span>
                </div>
            </div>
            <div class="contact-btn-wrapper">
                <button class="btn" @click="ouvrirModal()">Je reserve ma place</button>
            </div>
        </div>
    </section>

    <!-- Modal Reservation -->
    <div class="modal-overlay" v-if="modalOuverte" @click.self="fermerModal()">
        <div class="modal">
            <button class="modal-close" @click="fermerModal()">&times;</button>

            <!-- Barre de progression -->
            <div class="stepper">
                <div class="step" :class="{ active: etape >= 1, done: etape > 1 }">
                    <span class="step-num">1</span>
                    <span class="step-label">Date</span>
                </div>
                <div class="step-line" :class="{ active: etape >= 2 }"></div>
                <div class="step" :class="{ active: etape >= 2, done: etape > 2 }">
                    <span class="step-num">2</span>
                    <span class="step-label">Infos</span>
                </div>
                <div class="step-line" :class="{ active: etape >= 3 }"></div>
                <div class="step" :class="{ active: etape >= 3 }">
                    <span class="step-num">3</span>
                    <span class="step-label">Paiement</span>
                </div>
            </div>

            <!-- Etape 1 : Calendrier -->
            <div v-if="etape === 1">
                <h2 class="modal-title">Choisir une date</h2>
                <p class="modal-subtitle">Cours disponibles les lundis a 19h30</p>

                <div class="calendrier">
                    <div class="calendrier-header">
                        <button class="cal-nav" @click="moisPrecedent()" :disabled="estMoisMin">&larr;</button>
                        <span class="cal-mois">{{ nomMois }} {{ anneeCalendrier }}</span>
                        <button class="cal-nav" @click="moisSuivant()" :disabled="estMoisMax">&rarr;</button>
                    </div>
                    <div class="cal-jours-noms">
                        <span v-for="j in joursNoms" :key="j">{{ j }}</span>
                    </div>
                    <div class="cal-grille">
                        <div
                            v-for="(jour, index) in joursCalendrier"
                            :key="index"
                            class="cal-jour"
                            :class="{
                                'cal-vide': !jour,
                                'cal-dispo': jour && jour.dispo,
                                'cal-complet': jour && jour.complet,
                                'cal-absence': jour && jour.indispo,
                                'cal-indispo': jour && !jour.dispo && !jour.complet && !jour.indispo,
                                'cal-passe': jour && jour.passe
                            }"
                            @click="jour && jour.dispo ? choisirDate(jour) : null"
                        >
                            <template v-if="jour">
                                <span class="cal-jour-num">{{ jour.numero }}</span>
                                <span v-if="jour.dispo" class="cal-jour-places"><span class="desktop-only">{{ jour.inscrits }}/10 inscrits</span><span class="mobile-only">{{ jour.inscrits }}/10</span></span>
                                <span v-if="jour.complet" class="cal-jour-complet">Complet</span>
                                <span v-if="jour.indispo" class="cal-jour-complet">Absent</span>
                            </template>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Etape 2 : Nom + Email -->
            <div v-if="etape === 2">
                <h2 class="modal-title">Vos informations</h2>

                <div class="recap-mini">
                    <span>{{ dateChoisie.nomJour }} {{ dateChoisie.numero }} {{ dateChoisie.nomMois }}</span>
                    <span>19h30</span>
                </div>
                <div class="places-info">
                    <span class="places-badge">{{ dateChoisie.inscrits }}/10 inscrits</span>
                    <span class="places-restantes">{{ 10 - dateChoisie.inscrits }} place{{ (10 - dateChoisie.inscrits) > 1 ? 's' : '' }} restante{{ (10 - dateChoisie.inscrits) > 1 ? 's' : '' }}</span>
                </div>

                <div class="form-group">
                    <label for="clientNom">Nom complet</label>
                    <input
                        id="clientNom"
                        type="text"
                        v-model="clientNom"
                        placeholder="Votre nom"
                        class="form-input"
                    >
                </div>

                <div class="form-group">
                    <label for="clientEmail">Adresse email</label>
                    <input
                        id="clientEmail"
                        type="email"
                        v-model="clientEmail"
                        placeholder="votre@email.com"
                        class="form-input"
                        :class="{ 'input-error': emailErreur }"
                    >
                    <span class="form-error" v-if="emailErreur">{{ emailErreur }}</span>
                </div>

                <div class="form-group">
                    <label for="clientTel">Telephone</label>
                    <input
                        id="clientTel"
                        type="tel"
                        v-model="clientTel"
                        placeholder="06 12 34 56 78"
                        class="form-input"
                    >
                </div>

                <div class="confirm-actions">
                    <button class="btn btn-outline" @click="etape = 1">Retour</button>
                    <button class="btn" @click="allerAuPaiement()" :disabled="envoiEnCours">
                        <span v-if="!envoiEnCours">Continuer vers le paiement</span>
                        <span v-else class="spinner"></span>
                    </button>
                </div>
            </div>

            <!-- Etape 3 : Paiement -->
            <div v-if="etape === 3">
                <h2 class="modal-title">Paiement</h2>

                <div class="recap-paiement">
                    <div class="recap-mini">
                        <span>{{ dateChoisie.nomJour }} {{ dateChoisie.numero }} {{ dateChoisie.nomMois }}</span>
                        <span>19h30</span>
                    </div>
                    <div class="recap-ligne">
                        <span>{{ clientNom }}</span>
                        <span class="recap-prix">15&euro;</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Carte bancaire</label>
                    <div id="card-element"></div>
                    <span class="form-error" v-if="paiementErreur">{{ paiementErreur }}</span>
                </div>

                <div class="confirm-actions">
                    <button class="btn btn-outline" @click="retourEtape2()">Retour</button>
                    <button class="btn" @click="confirmerPaiement()" :disabled="envoiEnCours">
                        <span v-if="!envoiEnCours">Payer 15&euro;</span>
                        <span v-else class="spinner"></span>
                    </button>
                </div>
            </div>

            <!-- Message de succes -->
            <div v-if="reservationConfirmee" class="confirm-message">
                Reservation confirmee ! A bientot {{ clientNom }}.
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>Namaste — Anima Flow &copy; 2026</p>
        <div class="footer-legal">
            <a href="legal.html#mentions">Mentions legales</a>
            <a href="legal.html#cgv">CGV</a>
            <a href="legal.html#confidentialite">Confidentialite</a>
        </div>
    </footer>

</div>

<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
    Vue.createApp({
        data() {
            return {
                prixDecouverte: '10\u20AC',
                prixStandard: '20\u20AC',
                // Menu mobile
                menuOuvert: false,
                // Modal & calendrier
                modalOuverte: false,
                etape: 1,
                moisCalendrier: new Date().getMonth(),
                anneeCalendrier: new Date().getFullYear(),
                joursNoms: ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'],
                dateChoisie: null,
                // Formulaire
                clientNom: '',
                clientEmail: '',
                clientTel: '',
                emailErreur: '',
                envoiEnCours: false,
                reservationConfirmee: false,
                // Stripe
                stripe: null,
                cardElement: null,
                clientSecret: '',
                paiementErreur: '',
                // Compteurs de reservations par date
                reservationsCounts: {},
                // Dates d'indisponibilite d'Amina
                indisponibilites: []
            }
        },
        computed: {
            nomMois() {
                const noms = ['Janvier', 'Fevrier', 'Mars', 'Avril', 'Mai', 'Juin',
                    'Juillet', 'Aout', 'Septembre', 'Octobre', 'Novembre', 'Decembre'];
                return noms[this.moisCalendrier];
            },
            estMoisMin() {
                const now = new Date();
                return this.anneeCalendrier === now.getFullYear() && this.moisCalendrier === now.getMonth();
            },
            estMoisMax() {
                const now = new Date();
                let maxMois = now.getMonth() + 1;
                let maxAnnee = now.getFullYear();
                if (maxMois > 11) { maxMois = 0; maxAnnee++; }
                return this.anneeCalendrier === maxAnnee && this.moisCalendrier === maxMois;
            },
            joursCalendrier() {
                const an = this.anneeCalendrier;
                const mois = this.moisCalendrier;
                const premierJour = new Date(an, mois, 1);
                const dernierJour = new Date(an, mois + 1, 0);
                const nbJours = dernierJour.getDate();

                // getDay() : 0=Dim, on veut 0=Lun
                let startDay = premierJour.getDay() - 1;
                if (startDay < 0) startDay = 6;

                const aujourd = new Date();
                aujourd.setHours(0, 0, 0, 0);

                const jours = [];

                // Cases vides avant le 1er
                for (let i = 0; i < startDay; i++) {
                    jours.push(null);
                }

                for (let d = 1; d <= nbJours; d++) {
                    const date = new Date(an, mois, d);
                    const jourSemaine = date.getDay(); // 0=Dim, 1=Lun
                    const estLundi = (jourSemaine === 1);
                    const estPasse = date < aujourd;

                    const dateISO = `${an}-${String(mois + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                    const inscrits = this.reservationsCounts[dateISO] || 0;
                    const complet = inscrits >= 10;
                    const estIndispo = this.indisponibilites.includes(dateISO);

                    jours.push({
                        numero: d,
                        dispo: estLundi && !estPasse && !complet && !estIndispo,
                        complet: estLundi && !estPasse && complet && !estIndispo,
                        indispo: estLundi && !estPasse && estIndispo,
                        passe: estPasse,
                        date: date,
                        dateISO: dateISO,
                        inscrits: inscrits,
                        estCours: estLundi
                    });
                }

                return jours;
            }
        },
        methods: {
            async ouvrirModal() {
                this.modalOuverte = true;
                this.etape = 1;
                this.dateChoisie = null;
                this.clientNom = '';
                this.clientEmail = '';
                this.clientTel = '';
                this.emailErreur = '';
                this.envoiEnCours = false;
                this.reservationConfirmee = false;
                this.moisCalendrier = new Date().getMonth();
                this.anneeCalendrier = new Date().getFullYear();
                await Promise.all([this.chargerCompteurs(), this.chargerIndispos()]);
            },
            async chargerCompteurs() {
                try {
                    const response = await fetch('/api/reservations/count');
                    const data = await response.json();
                    this.reservationsCounts = data;
                } catch (err) {
                    console.error('Erreur chargement compteurs:', err);
                }
            },
            async chargerIndispos() {
                try {
                    const response = await fetch('/api/indisponibilites');
                    const data = await response.json();
                    this.indisponibilites = data;
                } catch (err) {
                    console.error('Erreur chargement indispos:', err);
                }
            },
            fermerModal() {
                this.modalOuverte = false;
            },
            moisPrecedent() {
                if (this.estMoisMin) return;
                if (this.moisCalendrier === 0) {
                    this.moisCalendrier = 11;
                    this.anneeCalendrier--;
                } else {
                    this.moisCalendrier--;
                }
            },
            moisSuivant() {
                if (this.estMoisMax) return;
                if (this.moisCalendrier === 11) {
                    this.moisCalendrier = 0;
                    this.anneeCalendrier++;
                } else {
                    this.moisCalendrier++;
                }
            },
            choisirDate(jour) {
                const nomsJours = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];
                const nomsMois = ['Janvier', 'Fevrier', 'Mars', 'Avril', 'Mai', 'Juin',
                    'Juillet', 'Aout', 'Septembre', 'Octobre', 'Novembre', 'Decembre'];
                this.dateChoisie = {
                    numero: jour.numero,
                    nomJour: nomsJours[jour.date.getDay()],
                    nomMois: nomsMois[jour.date.getMonth()],
                    annee: jour.date.getFullYear(),
                    inscrits: jour.inscrits,
                    dateISO: jour.dateISO
                };
                this.etape = 2;
            },
            async allerAuPaiement() {
                // Validation
                this.emailErreur = '';
                if (!this.clientNom.trim()) {
                    this.emailErreur = 'Veuillez entrer votre nom.';
                    return;
                }
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(this.clientEmail)) {
                    this.emailErreur = 'Veuillez entrer un email valide.';
                    return;
                }

                this.envoiEnCours = true;

                try {
                    const dateISO = this.dateChoisie.dateISO;

                    // Creer le PaymentIntent
                    const response = await fetch('/api/create-payment-intent', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            nom: this.clientNom,
                            email: this.clientEmail,
                            date: dateISO,
                            heure: '19h30'
                        })
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        this.emailErreur = data.error || 'Erreur lors de la creation du paiement.';
                        this.envoiEnCours = false;
                        return;
                    }

                    this.clientSecret = data.clientSecret;
                    this.envoiEnCours = false;
                    this.etape = 3;

                    // Monter Stripe Elements apres le rendu du DOM
                    this.$nextTick(() => this.monterStripeElements());
                } catch (err) {
                    this.emailErreur = 'Impossible de contacter le serveur.';
                    this.envoiEnCours = false;
                }
            },
            monterStripeElements() {
                if (!this.stripe) {
                    this.stripe = Stripe('pk_test_51T2Cpp9cD83akzSCPOtiInDSMXVW5alSXv8gejdBETNOwYgFg4YfOAxmlTfVg0Vrz4fix9jeFDgKi5gwOP0t07vK00jVVvp4eG', {
                        locale: 'fr'
                    });
                }
                const elements = this.stripe.elements();
                this.cardElement = elements.create('card', {
                    hidePostalCode: true,
                    style: {
                        base: {
                            fontSize: '16px',
                            color: '#333',
                            fontFamily: "'Lato', sans-serif",
                            '::placeholder': { color: '#999' }
                        },
                        invalid: { color: '#e74c3c' }
                    }
                });
                this.cardElement.mount('#card-element');
                this.cardElement.on('change', (event) => {
                    this.paiementErreur = event.error ? event.error.message : '';
                });
            },
            retourEtape2() {
                if (this.cardElement) {
                    this.cardElement.unmount();
                    this.cardElement = null;
                }
                this.paiementErreur = '';
                this.etape = 2;
            },
            async confirmerPaiement() {
                this.paiementErreur = '';
                this.envoiEnCours = true;

                try {
                    const { error, paymentIntent } = await this.stripe.confirmCardPayment(
                        this.clientSecret,
                        {
                            payment_method: {
                                card: this.cardElement,
                                billing_details: {
                                    name: this.clientNom,
                                    email: this.clientEmail
                                }
                            }
                        }
                    );

                    if (error) {
                        this.paiementErreur = error.message;
                        this.envoiEnCours = false;
                        return;
                    }

                    if (paymentIntent.status === 'succeeded') {
                        // Paiement OK → enregistrer la reservation dans Notion + emails
                        const dateISO = this.dateChoisie.dateISO;

                        const response = await fetch('/api/reservations', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                nom: this.clientNom,
                                email: this.clientEmail,
                                telephone: this.clientTel,
                                date: dateISO,
                                heure: '19h30'
                            })
                        });

                        const data = await response.json();

                        if (!response.ok) {
                            this.paiementErreur = data.error || 'Paiement reussi mais erreur de reservation. Contactez-nous.';
                            this.envoiEnCours = false;
                            return;
                        }

                        this.reservationConfirmee = true;
                        this.envoiEnCours = false;
                        setTimeout(() => {
                            this.modalOuverte = false;
                        }, 3000);
                    }
                } catch (err) {
                    this.paiementErreur = 'Erreur lors du paiement. Veuillez reessayer.';
                    this.envoiEnCours = false;
                }
            }
        }
    }).mount('#mon-app')
</script>
</body>
</html>
